<div class="history-page app-bg-textured">
  <div class="history-page__header">
    <h1 class="history-page__title">Ride History</h1>
    <div class="filter-button-wrapper">
      <button 
        class="filter-toggle-btn" 
        (click)="toggleFilterPanel()"
        [class.active]="showFilterPanel()">
        <span class="filter-icon">üîç</span>
        Filter
      </button>
      @if (showFilterPanel()) {
        <app-ride-history-filter-panel
          [initialFrom]="filterFrom()"
          [initialTo]="filterTo()"
          (filterApplied)="onFilterApplied($event)">
        </app-ride-history-filter-panel>
      }
    </div>
  </div>

  <div class="history-page__container">
    @if (loading()) {
      <div class="loading-state">
        <span class="loading-spinner"></span>
        Loading rides...
      </div>
    } @else if (error()) {
      <div class="error-state">
        {{ error() }}
      </div>
    } @else {
      <div class="table-wrapper">
        <table class="rides-table">
          <thead>
            <tr>
              <th class="sortable" (click)="onHeaderClick('ROUTE')">
                Route {{ getSortIcon('ROUTE') }}
              </th>
              <th class="sortable" (click)="onHeaderClick('START_TIME')">
                Start {{ getSortIcon('START_TIME') }}
              </th>
              <th class="sortable" (click)="onHeaderClick('END_TIME')">
                End {{ getSortIcon('END_TIME') }}
              </th>
            </tr>
          </thead>
          <tbody>
            @if (rides().length === 0) {
              <tr class="empty-row">
                <td colspan="3" class="empty-cell">No rides found.</td>
              </tr>
            }
            @for (ride of rides(); track ride.rideId) {
              <tr class="ride-row" (click)="onRowClick(ride)">
                <td class="route-cell">{{ formatRoute(ride) }}</td>
                <td>{{ formatDate(ride.startTime) }}</td>
                <td>{{ formatDate(ride.endTime) }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</div>

@if (detailsOpen()) {
  <app-passenger-ride-details-modal
    [details]="selectedRideDetails()"
    [loading]="detailsLoading()"
    (close)="closeDetails()">
  </app-passenger-ride-details-modal>
}

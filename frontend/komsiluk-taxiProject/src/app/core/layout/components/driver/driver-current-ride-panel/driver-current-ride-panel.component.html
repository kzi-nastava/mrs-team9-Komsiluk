<div class="cr" [formGroup]="form">

  @if (!hasRide() && !loading()) {
    <div class="cr-empty text-regular">
      You currently donâ€™t have any<br />
      rides.
    </div>
  }

  @if (loading()) {
    <div class="cr-loading text-regular">Loading...</div>
  }

  @if (hasRide() && !loading()) {

    <div class="cr-creator">
      <div class="cr-creator__avatar" aria-hidden="true">
        @if (creatorAvatarSrc()) {
          <img class="cr-creator__img" [src]="creatorAvatarSrc()!" alt="Passenger" />
        } @else {
          <svg viewBox="0 0 24 24" class="cr-creator__icon">
            <path d="M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4zm0 2c-3.33 0-8 1.67-8 5v1h16v-1c0-3.33-4.67-5-8-5z"></path>
          </svg>
        }
      </div>

      <div class="cr-creator__info">
        <div class="cr-creator__name text-semibold">
          {{ creatorLoading() ? 'Loading...' : creatorName() }}
        </div>
        <div class="cr-creator__email text-regular">
          {{ creatorLoading() ? '' : creatorEmail() }}
        </div>
      </div>
    </div>

    <div class="cr-field">
      <div class="cr-label text-regular">Pickup location</div>
      <input class="cr-input text-medium" type="text" formControlName="pickup" />
    </div>

    @if (stationsArr.length > 0) {
      <div class="cr-field">
        <div class="cr-label text-regular">Stations</div>

        <div class="cr-list" formArrayName="stations">
          @for (ctrl of stationsArr.controls; track $index; let i = $index) {
            <input class="cr-input cr-input--chip text-medium" type="text" [formControlName]="$index" />
          }
        </div>
      </div>
    }

    <div class="cr-field">
      <div class="cr-label text-regular">Destination</div>
      <input class="cr-input text-medium" type="text" formControlName="destination" />
    </div>

    @if (isScheduledLike()) {
      <div class="cr-actions">
        <button type="button" class="btn btn--ghost text-semibold btn-scale" (click)="cancel()">
          Cancel
        </button>

        <button type="button" class="btn btn--primary text-semibold btn-scale" (click)="openStartConfirm()">
          Start
        </button>
      </div>
    }

   @if (isActive()) {
      <div class="cr-actions cr-actions--active">
        <button type="button" class="btn btn--primary text-semibold btn-scale cr-full-width" (click)="finish()">
          Finish
        </button>

        <div class="cr-row">
          <button type="button" class="btn-sm btn--ghost text-semibold btn-scale cr-flex-1" (click)="stop()">
            Stop
          </button>

          <button type="button" class="btn-sm btn--ghost text-semibold btn-scale cr-flex-1" (click)="reportInconsistency()">
            Report
          </button>
        </div>

        <button type="button" class="btn-sm btn--danger text-semibold btn-scale cr-full-width" (click)="panic()">
          Panic
        </button>
      </div>
    }
  }

</div>
@if (showReportModal()) {
  <app-inconsistency-report-modal
    [rideId]="ride()!.id"
    (close)="showReportModal.set(false)"
    (submitted)="showReportModal.set(false)">
  </app-inconsistency-report-modal>
}